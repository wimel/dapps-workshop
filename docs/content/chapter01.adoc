== Introducción

=== Qué es una DApp

Una DApp es un tipo de aplicación de Internet cuyo _backend_ se ejecuta en una
red _peer-to-peer_ y, además, es _open source_. Ningún nodo de la red tiene
control completo sobre el funcionamiento de la aplicación.

Dependiendo de la funcionalidad de la DApp, se pueden usar múltiples estructuras
para almacenar los datos. *Bitcoin* es una DApp que usa una *_Blockchain_* para
almacenar los datos.

Los nodos de la red pueden ser cualquier sistema conectado a Internet, por lo
que detectar y prevenir quien distribuye información inválida es una tarea
complicada.

==== Protocolos de concenso

Como no tenemos un nodo central que pueda decidir cuáles son los datos válidos
o inválidos, necesitaremos un *protocolo* que permita a la red decidir.
Actualmente existen una serie de protocolos de conceso que intentan solucionar
este problema. Uno de los protocolos de conceso más populares es el
_Proof of Work_.

// TODO Apartado sobre algún protocolo de concneso

==== Clientes de la DApp

Para usar una DApp, necesitamos un nodo conectado a la red descentralizada para
poder intercambiar información con los otros nodos. Este nodo puede actuar
como pasarla para interactuar con la red y proporcionar una API que otras
aplicaciones consuman.

.Cliente de la DApp
[width=50%, align="center"]
image::figure01.png[Figura 1]

NOTE: Los clientes de las DApps deben ser _open source_ y su código debe ser
público, sino toda la idea de la descentralización se vendría abajo.

Como desplegar un nodo puede ser una tarea complicada y no apta para usuarios
no técnicos, podemos encontrar casos en los que se despliega un nodo que da
servicio a múltiple clientes para facilitarles el acceso a la DApp.

CAUTION: *Aplicación descentralizada != Aplicación distribuida*

==== Ventajas y desventajas de una DApp

===== Ventajas

* Son tolerantes a fallos ya que no existe un *punto único de fallo* porque
las aplicaciones descentralizadas son aplicaciones distribuidas.
* Evitan la censura, ya que no existe una autoridad central a la que un
gobierno pueda hacer presión para que la ejerza.
* No pueden ser bloqueadas, ya que no dependen de una única dirección IP.
La única opción sería intentar localizar todos los nodos de la red y
desconectarlos uno por uno, algo bastante complicado si la red es lo
suficientemente grande y se encuentra lo suficientemente distribuida.
* Ya que no existe una autoridad que controle la red, es más fácil depositar
la confianza en ella.

===== Inconvenientes

* La corrección de _bugs_ o la actualización son complicadas ya que todos los
nodos de la red deben actualizar su software.
* Algunas aplicaciones requieren que el usuario verifique su identidad y no
existe una autoridad central que pueda realizar la verificación.
* Son más complicadas de desarrollar debido a los protocolos de consenso y a
que deben estar muy bien diseñadas para que escalen desde el primer momento.
* No pueden depender de una aplicación de terceros si dicha aplicación es
centralizada, ya que se perdería la idea de la descentralización. Por ejemplo,
no pueden depende de una API. Aún así, pueden depende de otras DApps.

==== Autenticación en las DApps

A veces es necesario la funcionalidad de las cuentas de usuarios en una
aplicación. Los datos asociados a un usuario sólamente debería poder ser
modificados por éste. Las DApps no pueden funcionar mediante un sistema de
usuario y contraseña tradicional como hacen las aplicaciones centralizadas.

Existen diferentes formas de implementar cuentas de usuarios en DApps, aunque la
más utilizada es usando un sistema de clave pública-privada. Un hash de la
clave pública podría ser el ID de la cuenta de usuario. Para realizar un cambio
en unos datos asociados a una cuenta de usuario, la instrucción de cambiar los
datos debe firmarse utilizando la clave privada del usuario.

CAUTION: Si un usuario pierde su clave privada, pierde *para siempre* el acceso
a su cuenta.

==== Oráculos

Una DApp no debería depender de una aplicación centralizada ya que supone un
punto único de fallo, pero en algunos casos no queda otra opción si queremos
obtener datos como precios, información sobre el tiempo o números aleatorios.

Para acceder a estos datos necesitaríamos lo que se conoce como un *oráculo*,
que es el encargado de proveer estos datos. El oráculo actúa como un
intermediario de confianza. Un oráculo puede obtener los datos desde varias
fuentes y realizar comprobaciones para validar el dato.

****
En Ethereum podemos utilizar link:http://www.oraclize.it/[Oraclize] que
proporciona pruebas mediante link:https://tlsnotary.org/[TLSNotary] de que los
datos son válidos.
****

==== Divisa interna

Para que una aplicación sea sostenible debe ser viable económicamente para que
el propietario pueda seguir desarrollándola. Las DApps no tienen
un propietario, sin embargo, los nodos que corren el software necesitan
_hardware_ y otros recursos para poder funcionar, esto quiere decir que estos
nodos deben obtener algún beneficio por el hecho de estar ejecutando el
_software_. Aquí es donde entra en juego las divisas internas.

La mayoría de las DApps cuentan con una divisa interna y es el protocolo de
consenso quien decide cuánto se lleva cada nodo. Dependiendo del protocolo de
concenso puede ser que sólo un tipo determinado de nodo consiga esta divisa.

****
En el caso de Bitcoin, los mineros son los nodos que mantienen la red segura
y funcionando y son aquellos que reciben la recompensa. Los nodos "normales"
no reciben nada.
****

Lo siguiente que podríamos preguntarnos es: ¿Para qué nos puede servir esta
divisa? Según nos dice la economía, cualquier cosa que tenga una demanda tiene
un valor asociado. Si los usuarios deben pagar por usar la DApp, la demanda de
la divisa crecerá y el valor de ésta también. Si la cantidad de divisa que se
genera está limitada entonces su valor aumentará por la falta de ésta.

[NOTE]
====
La única desventaja de este sistema es que las DApps no son gratuitas. Aquí las
aplicaciones centralizadas tienen la ventaja de poder ofrecer un servicio gratis
a cambio de publicidad y servicios _premium_.
====

==== DApps con autorización

Hasta hora hemos estado hablando de DApps que son abiertas, es decir, que pueden
ser usadas por cualquiera. Por otra parte, existen DApps que necesitan
autorización para ser usadas, son conocidas como *_Permissioned DApps_*.

Estas DApps tienen todas las características de las DApps abiertas, pero para
entrar en la red se requiere autorización. Las DApps con autorización no usan
los mismos protocolos de concenso que las DApps abiertas y no tienen una divisa
interna.

==== Algunas aplicaciones descentralizadas

* link:https://bitcoin.org/en/[Bitcoin]
* link:https://www.ethereum.org/[Ethereum]
* link:https://www.hyperledger.org/[Hyperledger]
* link:https://ipfs.io/[IPFS]
* link:https://namecoin.org/[Namecoin]

=== Blockchain

Una *_Blockchain_* es una base de datos distribuida, formada por cadenas de
bloques diseñadas para evitar su modificación una vez que un dato ha sido
publicado. Se usa un sellado de tiempo confiable y cada bloque que se añade
se enlaza al bloque anterior.

Es adecuada para almacenar de forma creciente datos ordenados en el tiempo y
sin posibilidad de modificación ni revisión.

.Blockchain
[align="center"]
image::figure02.jpg[Figura 2]

Un bloque contiene información referente a los datos que se han almacenado
durante un periodo y un número aleatorio llamado *_nonce_*. El bloque es
*minado* y añadido a la cadena cuando se encuentra un _hash_ del mismo que
cumple unas condiciones impuestas.

El proceso de minado se basa en variar el valor del nonce hasta que el
_hash_ del bloque cumpla la condición impuesta.

****
En el caso de Bitcoin se exige que el hash calculado sea menor que un valor
`target` que es elegido por los nodos de la red para ajustar la dificultad de
minar un bloque. Esto se realiza para intentar que la diferencia de tiempo
entre el minado de bloques sea de aproximadamente 10 minutos.
****

Cada bloque que se añade lleva el hash del bloque anterior. Este sistema provoca
que un mínimo cambio que se produzca en un bloque provocaría que ese bloque y
todos los que vienen a continuación queden inmediatamente invalidados, pues
los _hashes_ de los bloques siguientes serían incorrectos. Esta comprobación es
muy sencilla de efectuar para un ordenador, por lo que es muy fácil verificar
la integridad de la cadena de bloques.

.Ejemplo de bloque en Bitcoin
****

[cols="p,p,p"]
|===

| Número mágico
| Siempre es `0xD9B4BEF9`
| 4 bytes

| Tamaño de bloque
| Número de bytes que faltan hasta el final del bloque
| 4 bytes

| Versión del bloque
| Se incrementa con las actualizaciones
| 4 bytes

| Hash del bloque anterior
| Hash de 256-bit correspondiente al bloque anterior
| 32 bytes

| Hash de todas las transacciones del bloque
| Hash de 256-bit de la raíz del árbol de Merkle
| 32 bytes

| Timestamp
| Segundos desde 1970-01-01T00:00 UTC
| 4 bytes

| Target
| Es el valor máximo que el _hash_ calculado puede tener
| 4 bytes

| Nonce
| Número de 32-bit que puede tomar cualquier valor
| 4 bytes

| Contador de transacciones
| Número de transacciones
| 1 - 9 bytes

| Transacciones
| Lista de transacciones
| Depende del número de transacciones
|===
****

Los nodos de una DApp pueden usar una cadena de bloques para almacenar los
datos y compartirlo con el resto de los nodos. Cada nodo debe verificar que
la cadena de bloques recibida sea correcta para aceptarla.

NOTE: La clave de este sistema es que es muy difícil generar una cadena de
bloques y muy fácil comprobar que es correcta. Esto hace que cualquier nodo
pueda verificar fácilmente la integridad y que un atacante lo tenga muy
complicado para generar una cadena de bloques falsa.

=== Ethereum
